<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Informasi Akun - DEBUG MODE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        /* SAYA RINGKAS CSS-NYA AGAR MUDAH DI-COPY */
        body { background: #f9fafb; font-family: 'Inter', sans-serif; display: flex; justify-content: center; padding: 20px; }
        .container { width: 100%; max-width: 500px; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .card { background: #f0f0f0; padding: 15px; margin-bottom: 10px; border-radius: 10px; display: flex; align-items: center; gap: 10px; }
        .card i { color: #DC2626; font-size: 20px; }
        h1 { text-align: center; color: #DC2626; margin-bottom: 20px; }
        button { width: 100%; padding: 15px; background: #DC2626; color: white; border: none; border-radius: 10px; font-weight: bold; margin-top: 20px; }
        .back-link { display: block; text-align: center; margin-top: 15px; color: #666; text-decoration: none; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üîç INFO AKUN (DEBUG)</h1>
        <p style="text-align: center; font-size: 12px; margin-bottom: 20px;">Mode ini akan menampilkan pesan error jika data gagal dimuat.</p>

        <div class="card">
            <i class="fa-solid fa-envelope"></i>
            <b id="debug-email">Sedang mengecek email...</b>
        </div>

        <div class="card">
            <i class="fa-solid fa-user"></i>
            <span id="debug-name">Sedang mengambil nama...</span>
        </div>

        <div class="card">
            <i class="fa-solid fa-briefcase"></i>
            <span id="debug-jabatan">Sedang mengambil jabatan...</span>
        </div>

        <div id="error-log" style="color: red; font-size: 11px; margin-top: 10px; white-space: pre-wrap; display: none; background: #ffebeb; padding: 10px;"></div>

        <button onclick="logout()">LOGOUT</button>
        <a href="home_akg.html" class="back-link">Kembali ke Home</a>
    </div>

    <script>
        const SUPABASE_URL = 'https://dsyvlavphvrdidmodokd.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzeXZsYXZwaHZyZGlkbW9kb2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNzI5NjMsImV4cCI6MjA4MTg0ODk2M30.mLmyZMUPtCaQl5Vck-Y7nImDFQuVWN_Mk6PrE-miP2E';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function init() {
            try {
                // 1. CEK SESI LOGIN
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError) throw new Error("Error Sesi: " + sessionError.message);
                if (!session) {
                    alert("Anda belum login! Kembali ke halaman awal.");
                    window.location.href = 'index.html';
                    return;
                }

                // Tampilkan Email (Ini pasti berhasil kalau login sukses)
                document.getElementById('debug-email').innerText = session.user.email;

                // 2. AMBIL DATA PROFIL
                const { data: profile, error: dbError } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', session.user.id)
                    .single();

                // 3. CEK ERROR DATABASE
                if (dbError) {
                    // Tampilkan Error di Layar
                    const msg = "GAGAL AMBIL DATA!\nPesan: " + dbError.message + "\nKode: " + dbError.code + "\nHint: " + dbError.hint;
                    document.getElementById('error-log').innerText = msg;
                    document.getElementById('error-log').style.display = 'block';
                    
                    document.getElementById('debug-name').innerText = "ERROR (Lihat bawah)";
                    document.getElementById('debug-jabatan').innerText = "ERROR";
                    
                    alert("‚ö†Ô∏è ADA MASALAH DATABASE:\n" + dbError.message + "\n\n(Coba jalankan SQL Langkah 1 lagi!)");
                    return;
                }

                // 4. JIKA DATA KOSONG (NULL)
                if (!profile) {
                    document.getElementById('debug-name').innerText = "DATA TIDAK DITEMUKAN";
                    alert("Akun login ada, tapi Data Profil KOSONG.\nSolusi: Logout -> Buat Akun Baru.");
                    return;
                }

                // 5. SUKSES
                document.getElementById('debug-name').innerText = profile.full_name;
                document.getElementById('debug-jabatan').innerText = profile.jabatan + " | " + profile.divisi;

            } catch (err) {
                alert("CRITICAL ERROR: " + err.message);
            }
        }

        async function logout() {
            await supabase.auth.signOut();
            window.location.href = 'index.html';
        }

        init();
    </script>
</body>
</html>
