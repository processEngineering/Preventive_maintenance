<html lang="id">
<head>
<meta charset="UTF-8">
<title>AF.SP 05.13 Rev-00 – FINAL PERFECT REPORT</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
@page { size: A4 landscape; margin: 5mm; }
body { font-family: 'Arial Narrow', Arial, sans-serif; font-size: 7pt; margin: 0; padding: 10px; background: #f4f4f4; }
.sheet { background: white; padding: 5mm; margin: auto; width: 285mm; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
table { border-collapse: collapse; width: 100%; table-layout: fixed; }
td, th { border: 1px solid black; padding: 1px; text-align: center; }
/* Header & Info /
.header-table td { border: 2px solid black; height: 45px; font-weight: bold; }
.logo-img { height: 35px; }
.info-table { border: none; margin: 5px 0; }
.info-table td { border: none; text-align: left; padding: 0; font-size: 8pt; }
.dot-line { border-bottom: 1px dotted #000; min-width: 120px; display: inline-block; padding-left: 5px; font-weight: bold; }
/ Table Content */
.bg-gray { background-color: #dfdfdf; font-weight: bold; text-align: left; padding-left: 5px; }
.col-nama { text-align: left; width: 180px; padding-left: 3px; }
.col-std { width: 130px; text-align: left; font-size: 6pt; }
.st-ng { color: white; font-weight: bold; background: #e21c1c; }
.st-na { color: black; font-weight: bold; background: #ffff00; }
/* Paraf Harian (Tanpa Teks) */
.sig-cell {
height: 40px;
padding: 0 !important;
vertical-align: middle;
background: #fff;
}
.sig-img {
max-height: 35px;
max-width: 24px;
mix-blend-mode: multiply;
display: block;
margin: 0 auto;
}
/* Footer Box Superintendent */
.footer-box {
border: 1px solid black;
height: 110px;
display: flex;
flex-direction: column;
justify-content: space-between;
align-items: center;
padding: 8px;
box-sizing: border-box;
}
.footer-title { font-size: 7pt; font-weight: bold; }
.sig-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; }
.sig-super-img { max-height: 65px; mix-blend-mode: multiply; }
.name-display { font-weight: bold; text-decoration: underline; text-transform: uppercase; font-size: 8.5pt; }
.no-print { background: #003366; color: white; padding: 10px; margin-bottom: 10px; border-radius: 5px; display: flex; gap: 10px; align-items: center; }
@media print { .no-print { display: none; } body { background: white; padding: 0; } .sheet { box-shadow: none; width: 100%; } }
</style>
</head>
<body>
<div class="no-print">
<b>PRINTER READY:</b>
<select id="machine-select"><option value="">Pilih Mesin...</option></select>
<select id="month-select"></select>
<select id="year-select"></select>
<button onclick="loadData()" style="padding:5px 15px; cursor:pointer; font-weight:bold;">TAMPILKAN DATA</button>
<button onclick="window.print()" style="padding:5px 15px; background: #28a745; color: white; cursor:pointer">CETAK</button>
</div>
<div class="sheet">
<table class="header-table">
<tr>
<td width="15%"><img src="https://amarilyskg.co.id/bootstrap/img/logo.png" class="logo-img"></td>
<td width="60%" style="font-size: 13pt;">CHECKLIST HARIAN MESIN INJECTION</td>
<td width="25%" style="text-align: left; font-size: 7pt; font-weight: normal; padding-left: 5px;">
No Dokumen : AF.SP 05.13.Rev-00<br>
Tgl Terbit : 02 Agustus 2024<br>
Halaman : 1/1<br>
Tgl Revisi : -
</td>
</tr>
</table>
<table class="info-table">
<tr>
<td width="10%">MERK MESIN</td><td width="1%">:</td><td width="20%"><span id="out-merk" class="dot-line">-</span></td>
<td width="10%">SERIAL NO</td><td width="1%">:</td><td width="20%"><span id="out-sn" class="dot-line">-</span></td>
<td width="8%">BULAN</td><td width="1%">:</td><td width="10%"><span id="out-bln" class="dot-line">-</span></td>
</tr>
<tr>
<td>TONAGE</td><td>:</td><td><span id="out-ton" class="dot-line">-</span></td>
<td></td><td></td><td></td>
<td>TAHUN</td><td>:</td><td><span id="out-thn" class="dot-line">-</span></td>
</tr>
</table>
<table>
<thead>
<tr>
<th rowspan="2" width="20">No</th>
<th rowspan="2" class="col-nama">Jenis Pengecekan</th>
<th rowspan="2" class="col-std">Standard</th>
<th rowspan="2" style="width:50px">METODE</th>
<th rowspan="2" style="width:60px">CATATAN</th>
<th colspan="31">Tanggal</th>
</tr>
<tr id="date-row"></tr>
</thead>
<tbody id="main-body"></tbody>
<tbody>
<tr>
<td colspan="5" style="text-align: right; font-weight: bold; padding-right: 8px; background: #f9f9f9;">Paraf Pelaksana</td>
<script>for(let i=1; i<=31; i++) document.write(`<td class="sig-cell" id="p-sig-${i}"></td>`);</script>
</tr>
<tr>
<td colspan="5" style="text-align: right; font-weight: bold; padding-right: 8px; background: #f9f9f9;">Paraf Koordinator</td>
<script>for(let i=1; i<=31; i++) document.write(`<td class="sig-cell" id="k-sig-${i}"></td>`);</script>
</tr>
</tbody>
</table>
<table style="border:none; margin-top: 10px;">
<tr>
<td width="65%" style="border:none; text-align: left; vertical-align: top; line-height: 1.4; font-size: 7.5pt;">
<b>Keterangan Simbol:</b><br>
√ : Kondisi Baik / Sesuai Standar | x : Kondisi Rusak / Penyimpangan | o : Mesin Perbaikan (Repair)<br>
<b>Catatan :</b><br>
(*) : Isi kolom laporan ceklist jika unit ini ada dimesin ini<br>
(**) : Diisi angka jam kerja mesin / running hour yang ada dimesin
</td>
<td width="35%" style="border:none;">
<div class="footer-box">
<div class="footer-title">DIKETAHUI<br>MECHANIC SUPERINTENDENT</div>
<div id="out-sig-super" class="sig-container"></div>
<div id="out-name-super" class="name-display">-</div>
</div>
</td>
</tr>
</table>
</div>
<script>
const _URL = "https://dsyvlavphvrdidmodokd.supabase.co";
const _KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzeXZsYXZwaHZyZGlkbW9kb2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNzI5NjMsImV4cCI6MjA4MTg0ODk2M30.mLmyZMUPtCaQl5Vck-Y7nImDFQuVWN_Mk6PrE-miP2E";
const sb = supabase.createClient(_URL, _KEY);
async function initFilter() {
const { data: m } = await sb.from('clhmi_machine').select('*').order('merk_mesin');
m?.forEach(x => document.getElementById('machine-select').add(new Option(`${x.merk_mesin} (${x.serial_no})`, x.id)));
const mo = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
mo.forEach((v, i) => document.getElementById('month-select').add(new Option(v, i+1)));
const y = new Date().getFullYear();
for(let i=y; i>=y-2; i--) document.getElementById('year-select').add(new Option(i, i));
let h = "";
for(let i=1; i<=31; i++) h += `<th width="24">${i}</th>`;
document.getElementById('date-row').innerHTML = h;
}
async function loadData() {
const mId = document.getElementById('machine-select').value;
const bln = document.getElementById('month-select').value;
const thn = document.getElementById('year-select').value;
if(!mId) return;
for(let i=1; i<=31; i++) {
document.getElementById(`p-sig-${i}`).innerHTML = "";
document.getElementById(`k-sig-${i}`).innerHTML = "";
}
const { data: headers } = await sb.from('clhmi').select('*').eq('machine_id', mId).eq('bulan', bln).eq('tahun', thn).order('tanggal_isi');
const { data: master } = await sb.from('clhmi_items').select('*').order('urutan');
if(!headers || headers.length === 0) { alert("Data tidak ditemukan."); return; }
let allRes = [];
for(const h of headers) {
const { data: r } = await sb.from('clhmi_results').select('*').eq('clhmi_id', h.id);
allRes = allRes.concat(r);
}
const head = headers[0];
document.getElementById('out-merk').innerText = head.merk_mesin;
document.getElementById('out-sn').innerText = head.serial_no;
document.getElementById('out-ton').innerText = head.tonage;
document.getElementById('out-bln').innerText = document.getElementById('month-select').options[bln-1].text;
document.getElementById('out-thn').innerText = thn;
const tbody = document.getElementById('main-body');
tbody.innerHTML = "";
let curCat = "";
master.forEach(m => {
if(m.kategori !== curCat) {
tbody.innerHTML += <tr><td colspan="36" class="bg-gray">${m.kategori}</td></tr>;
curCat = m.kategori;
}
let row = <tr><td>${m.item_kode||''}</td><td class="col-nama">${m.nama_pengecekan}</td><td class="col-std">${m.standar||'-'}</td><td>${m.metode||''}</td><td>${m.catatan||''}</td>;
for(let d=1; d<=31; d++) {
const f = allRes.find(r => r.item_id === m.id && parseInt(r.tanggal_cek.split('-')[2]) === d);
let sym = '';
let cls = '';
if (f) {
if (m.nama_pengecekan.includes('Running hour')) {
sym = f.value || '';
} else {
sym = (f.status === 'OK' ? '√' : (f.status === 'NG' ? 'x' : (f.status === 'NA' ? 'o' : '')));
cls = (f.status === 'NG' ? 'st-ng' : (f.status === 'NA' ? 'st-na' : ''));
}
}
row += <td class="${cls}">${sym}</td>;
}
tbody.innerHTML += row + "";
});
headers.forEach(h => {
const d = parseInt(h.tanggal_isi.split('-')[2]);
if(h.paraf) {
document.getElementById(p-sig-${d}).innerHTML = <img src="${h.paraf}" class="sig-img">;
}
if(h.paraf_coord) {
document.getElementById(k-sig-${d}).innerHTML = <img src="${h.paraf_coord}" class="sig-img">;
}
});
const fin = headers.find(h => h.status_form === 'finalized') || headers[headers.length - 1];
const outSig = document.getElementById('out-sig-super');
const outNam = document.getElementById('out-name-super');
if(fin && fin.paraf_super) {
outSig.innerHTML = <img src="${fin.paraf_super}" class="sig-super-img">;
outNam.innerText = fin.approved_by || "-";
} else {
outSig.innerHTML = "Belum Disahkan";
outNam.innerText = "-";
}
}
window.onload = initFilter;
</script>
</body>
</html>
