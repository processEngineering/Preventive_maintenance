<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daftar Akun (Verifikasi Email)</title>
    
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        /* Menggunakan style CSS yang sudah Anda buat sebelumnya (Black-Red Theme) */
        :root {
            --primary: #DC2626;
            --bg-main: #0A0A0A;
            --bg-card: #FFFFFF;
            --text-primary: #111111;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-main);
            /* Background gradient sederhana agar tidak terlalu berat */
            background-image: radial-gradient(ellipse at top center, rgba(220, 38, 38, 0.15) 0%, transparent 50%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px;
            color: #ffffff;
            margin: 0;
        }

        .card {
            width: 100%;
            max-width: 420px;
            background: var(--bg-card);
            border-radius: 24px;
            padding: 28px 24px;
            box-shadow: 0 8px 32px rgba(220, 38, 38, 0.3);
            border-top: 4px solid var(--primary);
            color: var(--text-primary);
        }

        h2 { margin-top: 0; color: #fff; text-shadow: 0 0 20px rgba(220, 38, 38, 0.5); }
        .card h2 { color: #000; text-shadow: none; margin-bottom: 5px; text-align: center; }
        p { color: #666; font-size: 14px; text-align: center; margin-bottom: 20px; }

        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px; text-transform: uppercase; }
        
        input, select {
            width: 100%;
            padding: 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            background: #fff;
            color: #000;
        }

        input:focus, select:focus { outline: none; border-color: var(--primary); }

        button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #DC2626 0%, #991B1B 100%);
            color: white;
            font-weight: 700;
            font-size: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 10px;
            text-transform: uppercase;
            box-shadow: 0 4px 14px rgba(220, 38, 38, 0.4);
        }
        button:active { transform: scale(0.98); }
        button:disabled { background: #4B5563; cursor: not-allowed; box-shadow: none; }

        .footer-link { text-align: center; margin-top: 24px; font-size: 14px; color: rgba(255, 255, 255, 0.7); }
        .footer-link a { color: var(--primary); text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>

    <div style="text-align: center; margin-bottom: 20px;">
        <div style="width: 72px; height: 72px; background: linear-gradient(135deg, #DC2626 0%, #991B1B 100%); border-radius: 24px; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4);">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
            </svg>
        </div>
        <h2>DAFTAR AKUN BARU</h2>
        <p style="color: rgba(255,255,255,0.7);">Silakan isi data untuk akses sistem</p>
    </div>

    <main class="card">
        <div class="form-group">
            <label>Nama Lengkap</label>
            <input type="text" id="fullname" placeholder="Contoh: Budi Santoso" required>
        </div>

        <div class="form-group">
            <label>Divisi</label>
            <input type="text" id="divisi" placeholder="Contoh: Produksi / Maintenance" required>
        </div>

        <div class="form-group">
            <label>Jabatan</label>
            <select id="jabatan" required>
                <option value="" disabled selected>-- PILIH JABATAN --</option>
                <option value="OPERATOR | PELAKSANA">OPERATOR | PELAKSANA</option>
                <option value="SUPERVISOR | KOORDINATOR">SUPERVISOR | KOORDINATOR</option>
                <option value="SUPERINTENDENT">SUPERINTENDENT</option>
                <option value="MANAGER">MANAGER</option>
            </select>
        </div>

        <div class="form-group">
            <label>Email</label>
            <input type="email" id="email" placeholder="email@perusahaan.com" required>
        </div>

        <div class="form-group">
            <label>Password</label>
            <input type="password" id="password" placeholder="Minimal 6 karakter" required>
        </div>

        <button type="button" onclick="registerUser()" id="btnDaftar">DAFTAR SEKARANG</button>
    </main>

    <p class="footer-link">Sudah punya akun? <a href="index.html">Masuk di sini</a></p>

    <script>
        // --- 1. KONFIGURASI SUPABASE (KEMBALI KE SUPABASE ANDA YG BENAR) ---
        const SUPABASE_URL = 'https://dsyvlavphvrdidmodokd.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzeXZsYXZwaHZyZGlkbW9kb2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNzI5NjMsImV4cCI6MjA4MTg0ODk2M30.mLmyZMUPtCaQl5Vck-Y7nImDFQuVWN_Mk6PrE-miP2E';
        
        // Cek apakah library Supabase berhasil dimuat
        if (typeof supabase === 'undefined') {
            alert("ERROR: Gagal memuat library Supabase. Periksa koneksi internet Anda.");
        } else {
            // Inisialisasi Client
            var client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        }

        async function registerUser() {
            const fullname = document.getElementById('fullname').value.trim();
            const divisi = document.getElementById('divisi').value.trim();
            const jabatan = document.getElementById('jabatan').value;
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            // --- VALIDASI INPUT ---
            if (!fullname || !divisi || !jabatan || !email || !password) {
                alert('Harap isi semua kolom!');
                return;
            }

            if (password.length < 6) {
                alert('Password minimal 6 karakter!');
                return;
            }

            const btn = document.getElementById('btnDaftar');
            btn.disabled = true;
            btn.textContent = 'MEMPROSES...';

            try {
                // --- STEP 1: DAFTAR AUTHENTICATION ---
                console.log("Mulai proses Sign Up..."); // Debugging
                
                const { data: authData, error: authError } = await client.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullname,
                            divisi: divisi,
                            jabatan: jabatan
                        }
                    }
                });

                if (authError) throw authError;

                console.log("Sign Up Auth Sukses:", authData);

                // --- STEP 2: SIMPAN KE TABEL PUBLIC (OPSIONAL) ---
                // Jika Anda punya tabel 'users' di public schema. 
                // Jika tidak punya tabel ini, bagian ini akan error tapi akun Auth tetap jadi.
                // Disarankan pakai TRY-CATCH terpisah agar user tidak bingung.
                
                if (authData.user) {
                    try {
                        const { error: profileError } = await client
                            .from('users') 
                            .insert([{
                                id: authData.user.id,
                                email: email,
                                full_name: fullname,
                                divisi: divisi,
                                jabatan: jabatan
                            }]);
                        
                        if (profileError) {
                            console.warn("Gagal simpan ke tabel users (mungkin tabel belum dibuat?), tapi Auth sukses.", profileError);
                        }
                    } catch (tableErr) {
                        console.warn("Error insert tabel:", tableErr);
                    }

                    // Logout agar user login manual setelah verifikasi email
                    await client.auth.signOut();

                    alert('PENDAFTARAN BERHASIL! \nSilakan CEK EMAIL Anda untuk verifikasi sebelum login.');
                    window.location.href = 'index.html';
                }

            } catch (error) {
                console.error('Error:', error);
                alert('Gagal mendaftar: ' + (error.message || 'Terjadi kesalahan jaringan/server'));
            } finally {
                btn.disabled = false;
                btn.textContent = 'DAFTAR SEKARANG';
            }
        }
    </script>
</body>
</html>
