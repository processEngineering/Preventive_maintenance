<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Log Excel & Tanda Tangan</title>
    <style>
        /* Style agar tabel terlihat seperti Excel */
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            font-family: Arial, sans-serif;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .excel-table th, .excel-table td {
            border: 1px solid #ccc;
            padding: 5px;
        }

        .excel-table th {
            background-color: #f0f0f0; /* Warna abu-abu khas header Excel */
            text-align: center;
            font-weight: bold;
        }

        .excel-table input {
            width: 100%;
            border: none;
            outline: none;
            padding: 4px;
            box-sizing: border-box; /* Agar padding tidak merusak lebar */
        }

        .excel-table input:focus {
            background-color: #e6f7ff; /* Highlight saat diketik */
        }

        /* Style untuk Tanda Tangan */
        .signature-container {
            border: 2px dashed #ccc;
            display: inline-block;
            position: relative;
            background: #fff;
        }
        
        canvas {
            display: block;
            cursor: crosshair;
        }

        .btn-clear {
            margin-top: 5px;
            padding: 5px 10px;
            background: #ff4d4d;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h2>Form Input Data Mesin</h2>

    <form id="logForm">
        <table class="excel-table">
            <thead>
                <tr>
                    <th style="width: 40px;">No</th>
                    <th>Parameter / Item Cek</th>
                    <th style="width: 100px;">Nilai</th>
                    <th>Keterangan</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>

        <h3>Tanda Tangan Pelaksana</h3>
        <div class="signature-container">
            <canvas id="signatureCanvas" width="300" height="150"></canvas>
        </div>
        <br>
        <button type="button" class="btn-clear" onclick="clearSignature()">Hapus Tanda Tangan</button>
        <input type="hidden" id="signatureData" name="signature">

        <br><br>
        <button type="submit" style="padding: 10px 20px; background: blue; color: white;">Simpan Data</button>
    </form>

    <script>
        // --- BAGIAN 1: GENERATE TABEL 25 BARIS ---
        const tableBody = document.getElementById('tableBody');
        const rowCount = 25; // Jumlah baris yang diinginkan

        for (let i = 1; i <= rowCount; i++) {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td style="text-align: center; background: #fafafa;">${i}</td>
                <td><input type="text" name="item_${i}" placeholder="Item cek..."></td>
                <td><input type="text" name="nilai_${i}" style="text-align: center;" placeholder="OK/Angka"></td>
                <td><input type="text" name="keterangan_${i}" placeholder="..."></td>
            `;
            tableBody.appendChild(row);
        }

        // --- BAGIAN 2: LOGIKA TANDA TANGAN (CANVAS) ---
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        // Setup gaya garis
        ctx.lineWidth = 2;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000';

        // Fungsi untuk mendapatkan posisi pointer (mouse atau touch)
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;
            
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        // Event Listeners Mouse (Desktop)
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        });

        canvas.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mouseout', () => isDrawing = false);

        // Event Listeners Touch (HP/Tablet) - PENTING AGAR TIDAK SCROLL
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Mencegah layar scroll saat tanda tangan
            isDrawing = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault(); // Mencegah layar scroll
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }, { passive: false });

        canvas.addEventListener('touchend', () => isDrawing = false);

        // Fungsi Hapus Tanda Tangan
        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // --- BAGIAN 3: PROSES SUBMIT ---
        document.getElementById('logForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // 1. Simpan Tanda Tangan ke format Gambar (Base64)
            // Cek apakah canvas kosong (opsional)
            const signatureDataUrl = canvas.toDataURL('image/png');
            document.getElementById('signatureData').value = signatureDataUrl;

            // 2. Ambil Data dari Tabel
            // Kita bisa loop lagi untuk mengambil value dari input
            let logData = [];
            for (let i = 1; i <= rowCount; i++) {
                // Ambil value berdasarkan nama input
                let item = document.querySelector(`input[name="item_${i}"]`).value;
                let nilai = document.querySelector(`input[name="nilai_${i}"]`).value;
                let ket = document.querySelector(`input[name="keterangan_${i}"]`).value;

                // Hanya masukkan ke data jika item diisi (opsional)
                if(item || nilai || ket) {
                    logData.push({
                        no: i,
                        item: item,
                        nilai: nilai,
                        keterangan: ket
                    });
                }
            }

            console.log("Data Tanda Tangan:", signatureDataUrl);
            console.log("Data Tabel:", logData);

            alert("Cek Console untuk melihat data yang siap dikirim ke Supabase!");
            
            // --- DISINI KODE SUPABASE INSERT ANDA ---
            // const { data, error } = await supabase.from('namatabel').insert([...])
        });
    </script>
</body>
</html>
