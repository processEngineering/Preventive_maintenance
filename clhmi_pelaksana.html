

PencarianCtrl+K
Percakapan
Ctrl+J
Suara
Bayangkan
Proyek
Riwayat
Hari Ini
December
<!DOCTYPE html> <html lang="id"> <head> &nbsp;&nbsp;&nbsp;&nbsp;<meta charset="UTF-8"> &nbsp;&nbsp;&nbsp;&nbsp;<meta name="viewport" content="width=device-width, initial-scale=1.0"> &nbsp;&nbsp;&nbsp;&nbsp;<title>CLHMI Pelaksana - Digital Form</title> &nbsp;&nbsp;&nbsp;&nbsp;<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> &nbsp;&nbsp;&nbsp;&nbsp;<script src="https://unpkg.com/html5-qrcode"></script> &nbsp;&nbsp;&nbsp;&nbsp;<style> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:root { --primary: #1e293b; --accent: #2563eb; --success: #16a34a; --danger: #dc2626; --bg: #f8fafc; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--primary); } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.container { max-width: 800px; margin: 0 auto; padding: 10px; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.card { background: #fff; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.form-header { background: var(--primary); color: #fff; padding: 20px; text-align: center; border-bottom: 4px solid var(--accent); } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.section { padding: 20px; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #f1f5f9; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.85rem; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table { width: 100%; border-collapse: collapse; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.cat-header { background: #e2e8f0; font-weight: bold; padding: 10px; color: var(--accent); text-transform: uppercase; font-size: 0.8rem; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;td { padding: 12px; border-bottom: 1px solid #e2e8f0; vertical-align: top; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.item-label { font-weight: 600; display: block; margin-bottom: 2px; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.item-method { font-size: 0.75rem; color: #64748b; font-style: italic; display: block; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; font-weight: bold; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.ng-input { display: none; margin-top: 10px; border: 1px solid #fca5a5; background: #fff1f2; padding: 8px; border-radius: 6px; width: 100%; box-sizing: border-box; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;canvas { border: 2px dashed #cbd5e1; border-radius: 8px; background: #fafafa; width: 100%; height: 180px; margin-top: 10px; touch-action: none; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.btn-primary { background: var(--accent); color: #fff; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#reader { border-radius: 12px; overflow: hidden; } &nbsp;&nbsp;&nbsp;&nbsp;</style> </head> <body> <div class="container"> &nbsp;&nbsp;&nbsp;&nbsp;<div class="card"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="form-header"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<h2 style="margin:0">FORM CHECKLIST MESIN</h2> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<small>Injection Molding Daily Maintenance</small> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="section" id="step-login"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label style="display:block; margin-bottom:8px; font-weight:bold">Nama Pelaksana</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="nama_pelaksana" style="width:100%; padding:12px; box-sizing:border-box; border-radius:8px; border:1px solid #ccc" placeholder="Contoh: Budi Santoso"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button class="btn btn-primary" style="margin-top:20px" onclick="startScanner()">üì∏ SCAN QR MESIN</button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="section" id="step-scan" style="display:none"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div id="reader"></div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button class="btn" style="background:#64748b; color:#fff; margin-top:10px" onclick="location.reload()">BATAL</button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="section" id="step-form" style="display:none"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="info-grid"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div><strong>MESIN:</strong> <span id="m_merk"></span></div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div><strong>SERIAL:</strong> <span id="m_serial"></span></div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div><strong>TONNAGE:</strong> <span id="m_ton"></span></div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div><strong>USER:</strong> <span id="m_user"></span></div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<form id="clForm"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tbody id="checklist-body"></tbody> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</table> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div style="margin-top:25px"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label style="font-weight:bold">‚úçÔ∏è Paraf Pelaksana</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<canvas id="canvas"></canvas> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" onclick="clearCanvas()" style="background:none; border:none; color:red; cursor:pointer; font-size:0.8rem">Hapus Paraf</button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="submit" class="btn btn-primary" id="btnSubmit" style="margin-top:20px">SIMPAN CHECKLIST</button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</form> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div> &nbsp;&nbsp;&nbsp;&nbsp;</div> </div> <script> const supabaseUrl = "https://dsyvlavphvrdidmodokd.supabase.co"; const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzeXZsYXZwaHZyZGlkbW9kb2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNzI5NjMsImV4cCI6MjA4MTg0ODk2M30.mLmyZMUPtCaQl5Vck-Y7nImDFQuVWN_Mk6PrE-miP2E"; const sb = supabase.createClient(supabaseUrl, supabaseKey); let html5QrCode; let machineData = null; let checklistItems = []; // Start Scanner function startScanner() { &nbsp;&nbsp;&nbsp;&nbsp;if(!document.getElementById("nama_pelaksana").value) return alert("Isi nama dahulu!"); &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("step-login").style.display = "none"; &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("step-scan").style.display = "block"; &nbsp;&nbsp;&nbsp;&nbsp;html5QrCode = new Html5Qrcode("reader"); &nbsp;&nbsp;&nbsp;&nbsp;html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, onScanSuccess); } async function onScanSuccess(text) { &nbsp;&nbsp;&nbsp;&nbsp;html5QrCode.stop(); &nbsp;&nbsp;&nbsp;&nbsp;const { data, error } = await sb.from("clhmi_machine").select("*").eq("merk_mesin", text.trim()).single(); &nbsp;&nbsp;&nbsp;&nbsp;if(error || !data) return alert("Mesin tidak terdaftar!"); &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;machineData = data; &nbsp;&nbsp;&nbsp;&nbsp;loadForm(); } async function loadForm() { &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("step-scan").style.display = "none"; &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("step-form").style.display = "block"; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("m_merk").innerText = machineData.merk_mesin; &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("m_serial").innerText = machineData.serial_no; &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("m_ton").innerText = machineData.tonage; &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("m_user").innerText = document.getElementById("nama_pelaksana").value; &nbsp;&nbsp;&nbsp;&nbsp;const { data: items } = await sb.from("clhmi_items").select("*").eq("aktif", true).order("urutan", { ascending: true }); &nbsp;&nbsp;&nbsp;&nbsp;checklistItems = items; &nbsp;&nbsp;&nbsp;&nbsp;let html = ""; &nbsp;&nbsp;&nbsp;&nbsp;let lastCat = ""; &nbsp;&nbsp;&nbsp;&nbsp;items.forEach(item => { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(item.kategori !== lastCat) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastCat = item.kategori; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html += `<tr><td colspan="2" class="cat-header">${lastCat}</td></tr>`; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html += ` &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="item-label">${item.nama_pengecekan}</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="item-method">Metode: ${item.item_kode}</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea class="ng-input" id="note_${item.id}" placeholder="Tulis alasan NG..."></textarea> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td style="width:80px"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select id="st_$$ {item.id}" onchange="checkStatus(' $${item.id}', this)"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<option value="OK">OK</option> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<option value="NG">NG</option> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<option value="NA">NA</option> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</select> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr>`; &nbsp;&nbsp;&nbsp;&nbsp;}); &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById("checklist-body").innerHTML = html; &nbsp;&nbsp;&nbsp;&nbsp;initCanvas(); } function checkStatus(id, el) { &nbsp;&nbsp;&nbsp;&nbsp;const note = document.getElementById("note_" + id); &nbsp;&nbsp;&nbsp;&nbsp;note.style.display = (el.value === "NG") ? "block" : "none"; &nbsp;&nbsp;&nbsp;&nbsp;el.style.color = (el.value === "NG") ? "red" : (el.value === "OK" ? "green" : "black"); } // Canvas Paraf const canvas = document.getElementById("canvas"); const ctx = canvas.getContext("2d"); let drawing = false; function initCanvas() { &nbsp;&nbsp;&nbsp;&nbsp;canvas.width = canvas.offsetWidth; &nbsp;&nbsp;&nbsp;&nbsp;canvas.height = canvas.offsetHeight; &nbsp;&nbsp;&nbsp;&nbsp;ctx.lineWidth = 3; &nbsp;&nbsp;&nbsp;&nbsp;ctx.lineCap = "round"; &nbsp;&nbsp;&nbsp;&nbsp;ctx.strokeStyle = "#1e293b"; } canvas.addEventListener("mousedown", startDraw); canvas.addEventListener("mousemove", draw); window.addEventListener("mouseup", stopDraw); canvas.addEventListener("touchstart", (e) => { startDraw(e.touches[0]); e.preventDefault(); }); canvas.addEventListener("touchmove", (e) => { draw(e.touches[0]); e.preventDefault(); }); canvas.addEventListener("touchend", stopDraw); function startDraw(e) { drawing = true; ctx.beginPath(); ctx.moveTo(e.clientX - canvas.getBoundingClientRect().left, e.clientY - canvas.getBoundingClientRect().top); } function draw(e) { if(!drawing) return; ctx.lineTo(e.clientX - canvas.getBoundingClientRect().left, e.clientY - canvas.getBoundingClientRect().top); ctx.stroke(); } function stopDraw() { drawing = false; } function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); } // Submit document.getElementById("clForm").onsubmit = async (e) => { &nbsp;&nbsp;&nbsp;&nbsp;e.preventDefault(); &nbsp;&nbsp;&nbsp;&nbsp;const btn = document.getElementById("btnSubmit"); &nbsp;&nbsp;&nbsp;&nbsp;const sig = canvas.toDataURL(); &nbsp;&nbsp;&nbsp;&nbsp;if(sig.length < 2000) return alert("Tanda tangan dulu!"); &nbsp;&nbsp;&nbsp;&nbsp;btn.disabled = true; &nbsp;&nbsp;&nbsp;&nbsp;btn.innerText = "MENYIMPAN..."; &nbsp;&nbsp;&nbsp;&nbsp;const now = new Date(); &nbsp;&nbsp;&nbsp;&nbsp;const { data: hdr, error: e1 } = await sb.from("clhmi").insert([{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;machine_id: machineData.id, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;merk_mesin: machineData.merk_mesin, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tonage: machineData.tonage, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serial_no: machineData.serial_no, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tahun: now.getFullYear(), &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bulan: now.getMonth() + 1, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tanggal_isi: now.toISOString().split('T')[0], &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pelaksana: document.getElementById("nama_pelaksana").value, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paraf: sig &nbsp;&nbsp;&nbsp;&nbsp;}]).select().single(); &nbsp;&nbsp;&nbsp;&nbsp;if(e1) { alert("Error Simpan: " + e1.message); btn.disabled = false; return; } &nbsp;&nbsp;&nbsp;&nbsp;const details = checklistItems.map(item => ({ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clhmi_id: hdr.id, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item_id: item.id, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item_code: item.item_kode, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status: document.getElementById("st_" + item.id).value, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catatan_item: document.getElementById("note_" + item.id).value || null, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tanggal_cek: now.toISOString().split('T')[0], &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diisi_oleh: document.getElementById("nama_pelaksana").value &nbsp;&nbsp;&nbsp;&nbsp;})); &nbsp;&nbsp;&nbsp;&nbsp;const { error: e2 } = await sb.from("clhmi_results").insert(details); &nbsp;&nbsp;&nbsp;&nbsp;if(e2) alert("Gagal Simpan Detail: " + e2.message); &nbsp;&nbsp;&nbsp;&nbsp;else { alert("‚úÖ Berhasil Disimpan!"); location.reload(); } }; </script> </body> </html>         LENGKAPI KODE INI SESUAI LIST YANG ADA DI TABEL JANGAN SAMAPI ADA YANG TERTINGAAL DALAM BENTUK FORM,RAPIKAN PENEMPATANNYA
AF.SP 05.13.Rev-00 - CHECKLIST HARIAN MESIN INJECTION.xlsx
HTML
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLHMI Pelaksana - Digital Form</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        :root { --primary: #1e293b; --accent: #2563eb; --success: #16a34a; --danger: #dc2626; --bg: #f8fafc; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--primary); }
        .container { max-width: 800px; margin: 0 auto; padding: 10px; }
        .card { background: #fff; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; }
        .form-header { background: var(--primary); color: #fff; padding: 20px; text-align: center; border-bottom: 4px solid var(--accent); }
        .section { padding: 20px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #f1f5f9; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.85rem; }
       
        table { width: 100%; border-collapse: collapse; }
        .cat-header { background: #e2e8f0; font-weight: bold; padding: 10px; color: var(--accent); text-transform: uppercase; font-size: 0.8rem; }
        td { padding: 12px; border-bottom: 1px solid #e2e8f0; vertical-align: top; }
       
        .item-label { font-weight: 600; display: block; margin-bottom: 2px; }
        .item-method { font-size: 0.75rem; color: #64748b; font-style: italic; display: block; }
       
        select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; font-weight: bold; }
        .ng-input { display: none; margin-top: 10px; border: 1px solid #fca5a5; background: #fff1f2; padding: 8px; border-radius: 6px; width: 100%; box-sizing: border-box; }
       
        canvas { border: 2px dashed #cbd5e1; border-radius: 8px; background: #fafafa; width: 100%; height: 180px; margin-top: 10px; touch-action: none; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: #fff; }
        #reader { border-radius: 12px; overflow: hidden; }
    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <div class="form-header">
            <h2 style="margin:0">FORM CHECKLIST MESIN</h2>
            <small>Injection Molding Daily Maintenance</small>
        </div>
        <div class="section" id="step-login">
            <label style="display:block; margin-bottom:8px; font-weight:bold">Nama Pelaksana</label>
            <input type="text" id="nama_pelaksana" style="width:100%; padding:12px; box-sizing:border-box; border-radius:8px; border:1px solid #ccc" placeholder="Contoh: Budi Santoso">
            <button class="btn btn-primary" style="margin-top:20px" onclick="startScanner()">üì∏ SCAN QR MESIN</button>
        </div>
        <div class="section" id="step-scan" style="display:none">
            <div id="reader"></div>
            <button class="btn" style="background:#64748b; color:#fff; margin-top:10px" onclick="location.reload()">BATAL</button>
        </div>
        <div class="section" id="step-form" style="display:none">
            <div class="info-grid">
                <div><strong>MESIN:</strong> <span id="m_merk"></span></div>
                <div><strong>SERIAL:</strong> <span id="m_serial"></span></div>
                <div><strong>TONNAGE:</strong> <span id="m_ton"></span></div>
                <div><strong>USER:</strong> <span id="m_user"></span></div>
            </div>
            <form id="clForm">
                <table>
                    <tbody id="checklist-body">
                        <!-- Kategori 1: Mekanikal -->
                        <tr><td colspan="2" class="cat-header">1. Mekanikal</td></tr>
                        <tr>
                            <td>
                                <span class="item-label">a. Nozzle visual (Radius tidak rusak, tidak ada leleah material meler)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_1a" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1a" onchange="checkStatus('1a', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">b. Kebersihan Head Nozzle barrel (tidak ada material yang menempel)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_1b" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1b" onchange="checkStatus('1b', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">c. Check level oli mesin (> Level garis tengah)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_1c" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1c" onchange="checkStatus('1c', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">d. Check pump central lubrikasi (berfungsi baik)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_1d" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1d" onchange="checkStatus('1d', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">e. Check keseluruhan kondisi mesin (Lengkap dan bersih)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_1e" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1e" onchange="checkStatus('1e', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">f. Check kondisi lampu indicator (Nyala sesuai fungsi)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_1f" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1f" onchange="checkStatus('1f', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">g. Pastikan pintu panel kontrol tertutup (Tertutup)</span>
                                <span class="item-method">Metode: Tangan</span>
                                <textarea class="ng-input" id="note_1g" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1g" onchange="checkStatus('1g', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">h. Check temperatur oli (40 - 50¬∞C)</span>
                                <span class="item-method">Metode: Display control</span>
                                <textarea class="ng-input" id="note_1h" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1h" onchange="checkStatus('1h', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">i. Running hour (jam)(**) (Sesuai aktual mesin)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_1i" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_1i" onchange="checkStatus('1i', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>

                        <!-- Kategori 2: Kebersihan debu -->
                        <tr><td colspan="2" class="cat-header">2. Kebersihan debu</td></tr>
                        <tr>
                            <td>
                                <span class="item-label">a. Pintu Mesin (kaca/acrilric) (Bersih tidak berdebu)</span>
                                <span class="item-method">Metode: Lap majun</span>
                                <textarea class="ng-input" id="note_2a" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_2a" onchange="checkStatus('2a', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">b. Kap mesin (Bersih tidak berdebu)</span>
                                <span class="item-method">Metode: Lap majun</span>
                                <textarea class="ng-input" id="note_2b" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_2b" onchange="checkStatus('2b', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">c. Kap inject unit (Bersih tidak berdebu)</span>
                                <span class="item-method">Metode: Lap majun</span>
                                <textarea class="ng-input" id="note_2c" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_2c" onchange="checkStatus('2c', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">d. Panel mesin (Bersih tidak berdebu)</span>
                                <span class="item-method">Metode: Lap majun</span>
                                <textarea class="ng-input" id="note_2d" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_2d" onchange="checkStatus('2d', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>

                        <!-- Kategori 3: Kebersihan Oli -->
                        <tr><td colspan="2" class="cat-header">3. Kebersihan Oli</td></tr>
                        <tr>
                            <td>
                                <span class="item-label">a. Lantai area mesin (Tidak kotor oli)</span>
                                <span class="item-method">Metode: Lap & busa spon</span>
                                <textarea class="ng-input" id="note_3a" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_3a" onchange="checkStatus('3a', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">b. Bawah mesin (Tidak kotor oli)</span>
                                <span class="item-method">Metode: Lap & busa spon</span>
                                <textarea class="ng-input" id="note_3b" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_3b" onchange="checkStatus('3b', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">c. Bawah inject unit (Tidak kotor oli)</span>
                                <span class="item-method">Metode: Lap & busa spon</span>
                                <textarea class="ng-input" id="note_3c" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_3c" onchange="checkStatus('3c', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>

                        <!-- Kategori 4: Kebersihan Air -->
                        <tr><td colspan="2" class="cat-header">4. Kebersihan Air</td></tr>
                        <tr>
                            <td>
                                <span class="item-label">a. Pemeriksaan instalasi air (Fitting / balvalve tidak bocor)</span>
                                <span class="item-method">Metode: Lap majun</span>
                                <textarea class="ng-input" id="note_4a" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_4a" onchange="checkStatus('4a', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">b. Embun pipa chiller (Dilindungi armaflek)</span>
                                <span class="item-method">Metode: Lap majun</span>
                                <textarea class="ng-input" id="note_4b" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_4b" onchange="checkStatus('4b', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>

                        <!-- Kategori 5: Kebersihan Area Mesin -->
                        <tr><td colspan="2" class="cat-header">5. Kebersihan Area Mesin</td></tr>
                        <tr>
                            <td>
                                <span class="item-label">a. Pemeriksaan alat kerja/ sparepart setelah perbaikan (Area mesin bersih, tidak terdapat ceceran tools & sparepart)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_5a" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_5a" onchange="checkStatus('5a', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="item-label">b. Kelengkapan selang angin sprial & air gun (Terpasang rapih, lengkap dan berfungsi)</span>
                                <span class="item-method">Metode: Visual</span>
                                <textarea class="ng-input" id="note_5b" placeholder="Tulis alasan NG..."></textarea>
                            </td>
                            <td style="width:80px">
                                <select id="st_5b" onchange="checkStatus('5b', this)">
                                    <option value="OK">OK</option>
                                    <option value="NG">NG</option>
                                    <option value="NA">NA</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div style="margin-top:25px">
                    <label style="font-weight:bold">‚úçÔ∏è Paraf Pelaksana</label>
                    <canvas id="canvas"></canvas>
                    <button type="button" onclick="clearCanvas()" style="background:none; border:none; color:red; cursor:pointer; font-size:0.8rem">Hapus Paraf</button>
                </div>
                <button type="submit" class="btn btn-primary" id="btnSubmit" style="margin-top:20px">SIMPAN CHECKLIST</button>
            </form>
        </div>
    </div>
</div>
<script>
const supabaseUrl = "https://dsyvlavphvrdidmodokd.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzeXZsYXZwaHZyZGlkbW9kb2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNzI5NjMsImV4cCI6MjA4MTg0ODk2M30.mLmyZMUPtCaQl5Vck-Y7nImDFQuVWN_Mk6PrE-miP2E";
const sb = supabase.createClient(supabaseUrl, supabaseKey);
let html5QrCode;
let machineData = null;
let checklistItems = [
    // Items hard-coded from Excel
    {id: '1a', kategori: '1. Mekanikal', nama_pengecekan: 'a. Nozzle visual (Radius tidak rusak, tidak ada leleah material meler)', item_kode: 'Visual'},
    {id: '1b', kategori: '1. Mekanikal', nama_pengecekan: 'b. Kebersihan Head Nozzle barrel (tidak ada material yang menempel)', item_kode: 'Visual'},
    {id: '1c', kategori: '1. Mekanikal', nama_pengecekan: 'c. Check level oli mesin (> Level garis tengah)', item_kode: 'Visual'},
    {id: '1d', kategori: '1. Mekanikal', nama_pengecekan: 'd. Check pump central lubrikasi (berfungsi baik)', item_kode: 'Visual'},
    {id: '1e', kategori: '1. Mekanikal', nama_pengecekan: 'e. Check keseluruhan kondisi mesin (Lengkap dan bersih)', item_kode: 'Visual'},
    {id: '1f', kategori: '1. Mekanikal', nama_pengecekan: 'f. Check kondisi lampu indicator (Nyala sesuai fungsi)', item_kode: 'Visual'},
    {id: '1g', kategori: '1. Mekanikal', nama_pengecekan: 'g. Pastikan pintu panel kontrol tertutup (Tertutup)', item_kode: 'Tangan'},
    {id: '1h', kategori: '1. Mekanikal', nama_pengecekan: 'h. Check temperatur oli (40 - 50¬∞C)', item_kode: 'Display control'},
    {id: '1i', kategori: '1. Mekanikal', nama_pengecekan: 'i. Running hour (jam)(**) (Sesuai aktual mesin)', item_kode: 'Visual'},
    {id: '2a', kategori: '2. Kebersihan debu', nama_pengecekan: 'a. Pintu Mesin (kaca/acrilric) (Bersih tidak berdebu)', item_kode: 'Lap majun'},
    {id: '2b', kategori: '2. Kebersihan debu', nama_pengecekan: 'b. Kap mesin (Bersih tidak berdebu)', item_kode: 'Lap majun'},
    {id: '2c', kategori: '2. Kebersihan debu', nama_pengecekan: 'c. Kap inject unit (Bersih tidak berdebu)', item_kode: 'Lap majun'},
    {id: '2d', kategori: '2. Kebersihan debu', nama_pengecekan: 'd. Panel mesin (Bersih tidak berdebu)', item_kode: 'Lap majun'},
    {id: '3a', kategori: '3. Kebersihan Oli', nama_pengecekan: 'a. Lantai area mesin (Tidak kotor oli)', item_kode: 'Lap & busa spon'},
    {id: '3b', kategori: '3. Kebersihan Oli', nama_pengecekan: 'b. Bawah mesin (Tidak kotor oli)', item_kode: 'Lap & busa spon'},
    {id: '3c', kategori: '3. Kebersihan Oli', nama_pengecekan: 'c. Bawah inject unit (Tidak kotor oli)', item_kode: 'Lap & busa spon'},
    {id: '4a', kategori: '4. Kebersihan Air', nama_pengecekan: 'a. Pemeriksaan instalasi air (Fitting / balvalve tidak bocor)', item_kode: 'Lap majun'},
    {id: '4b', kategori: '4. Kebersihan Air', nama_pengecekan: 'b. Embun pipa chiller (Dilindungi armaflek)', item_kode: 'Lap majun'},
    {id: '5a', kategori: '5. Kebersihan Area Mesin', nama_pengecekan: 'a. Pemeriksaan alat kerja/ sparepart setelah perbaikan (Area mesin bersih, tidak terdapat ceceran tools & sparepart)', item_kode: 'Visual'},
    {id: '5b', kategori: '5. Kebersihan Area Mesin', nama_pengecekan: 'b. Kelengkapan selang angin sprial & air gun (Terpasang rapih, lengkap dan berfungsi)', item_kode: 'Visual'}
];
// Start Scanner
function startScanner() {
    if(!document.getElementById("nama_pelaksana").value) return alert("Isi nama dahulu!");
    document.getElementById("step-login").style.display = "none";
    document.getElementById("step-scan").style.display = "block";
    html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, onScanSuccess);
}
async function onScanSuccess(text) {
    html5QrCode.stop();
    const { data, error } = await sb.from("clhmi_machine").select("*").eq("merk_mesin", text.trim()).single();
    if(error || !data) return alert("Mesin tidak terdaftar!");
   
    machineData = data;
    loadForm();
}
function loadForm() {
    document.getElementById("step-scan").style.display = "none";
    document.getElementById("step-form").style.display = "block";
   
    document.getElementById("m_merk").innerText = machineData.merk_mesin;
    document.getElementById("m_serial").innerText = machineData.serial_no;
    document.getElementById("m_ton").innerText = machineData.tonage;
    document.getElementById("m_user").innerText = document.getElementById("nama_pelaksana").value;
    initCanvas();
}
function checkStatus(id, el) {
    const note = document.getElementById("note_" + id);
    note.style.display = (el.value === "NG") ? "block" : "none";
    el.style.color = (el.value === "NG") ? "red" : (el.value === "OK" ? "green" : "black");
}
// Canvas Paraf
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let drawing = false;
function initCanvas() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    ctx.lineWidth = 3;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#1e293b";
}
canvas.addEventListener("mousedown", startDraw);
canvas.addEventListener("mousemove", draw);
window.addEventListener("mouseup", stopDraw);
canvas.addEventListener("touchstart", (e) => { startDraw(e.touches[0]); e.preventDefault(); });
canvas.addEventListener("touchmove", (e) => { draw(e.touches[0]); e.preventDefault(); });
canvas.addEventListener("touchend", stopDraw);
function startDraw(e) { drawing = true; ctx.beginPath(); ctx.moveTo(e.clientX - canvas.getBoundingClientRect().left, e.clientY - canvas.getBoundingClientRect().top); }
function draw(e) { if(!drawing) return; ctx.lineTo(e.clientX - canvas.getBoundingClientRect().left, e.clientY - canvas.getBoundingClientRect().top); ctx.stroke(); }
function stopDraw() { drawing = false; }
function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
// Submit
document.getElementById("clForm").onsubmit = async (e) => {
    e.preventDefault();
    const btn = document.getElementById("btnSubmit");
    const sig = canvas.toDataURL();
    if(sig.length < 2000) return alert("Tanda tangan dulu!");
    btn.disabled = true;
    btn.innerText = "MENYIMPAN...";
    const now = new Date();
    const { data: hdr, error: e1 } = await sb.from("clhmi").insert([{
        machine_id: machineData.id,
        merk_mesin: machineData.merk_mesin,
        tonage: machineData.tonage,
        serial_no: machineData.serial_no,
        tahun: now.getFullYear(),
        bulan: now.getMonth() + 1,
        tanggal_isi: now.toISOString().split('T')[0],
        pelaksana: document.getElementById("nama_pelaksana").value,
        paraf: sig
    }]).select().single();
    if(e1) { alert("Error Simpan: " + e1.message); btn.disabled = false; return; }
    const details = checklistItems.map(item => ({
        clhmi_id: hdr.id,
        item_id: item.id,
        item_code: item.item_kode,
        status: document.getElementById("st_" + item.id).value,
        catatan_item: document.getElementById("note_" + item.id).value || null,
        tanggal_cek: now.toISOString().split('T')[0],
        diisi_oleh: document.getElementById("nama_pelaksana").value
    }));
    const { error: e2 } = await sb.from("clhmi_results").insert(details);
    if(e2) alert("Gagal Simpan Detail: " + e2.message);
    else { alert("‚úÖ Berhasil Disimpan!"); location.reload(); }
};
</script>
</body>
</html>
24,8s



Tingkatkan ke SuperGrok
New conversation - Grok
